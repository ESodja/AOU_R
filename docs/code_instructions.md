---
layout: default
title: Coding Instructions
permalink: /how-to/coding
---
# Coding Instructions

## Quick Reference:
> 1. Generate your dataset on the researcher workbench
> 2. Initialize your RStudio cloud environment
> 3. Download and upload the [zip file](/R_files.zip) to the cloud environment (it will unzip automatically)
> 4. Copy the SQL code into 'Data_import.R'
> 5. Determine the analysis you would like to run and which files need to be run to accomplish that
> 6. Identify and modify code to adjust the existing system to do what you want it to
> 7. Type `source('filename.R')` into the RStudio console and press `Enter` or `Return` for each file in order, from top to bottom of the flowchart
> 8. Look at the outputs and download your plots and statistical reports

## Full Instructions:
To modify and use the automated analysis I've built, follow the instructions below:

### 1. **Generate the desired dataset from the dataset builder on the AoU workbench**

Help can be found [here](https://support.researchallofus.org/hc/en-us/articles/4556645124244-Using-the-Concept-Set-Selector-and-Dataset-Builder-tools-to-build-your-dataset).

This system requires that the data have a few specific elements and meet a few requirements to automatically process. The guidelines can be found [here](/datareqs). 

The code includes commented lines with instructions that will let you select some alternative approaches, analyses, or outputs. In most cases, if you uncomment a line, it will be after the original line and will overwrite the original coded process; if this is not the case, a comment in the code indicates this. You may also want to comment out the original lines of code if you find you have to wait for a long time (more than a few minutes) for one of the steps to run. Make sure at least one of the lines of code is uncommented so you don't run in to errors!
[screenshot of commenting/uncommenting code]

### 2. **Initialize your RStudio cloud environment**

[screenshots]
This will take some time, 

### 3. **Download and upload R_files.zip to RStudio**

Download the zipfile of R scripts from [here](/R_files.zip).

In RStudio, in the 'files' tab on the bottom right pane, click 'Upload', select 'Browse...', select the zip file, and click 'OK'. RStudio will automatically unzip the contents of the zipfile into your home directory.
[screenshots need pointers and stuff]

![In RStudio Files tab, select 'Upload'...](/images/RStudio_zipupload.png)

![...Browse to the zip file you downloaded...](/images/RStudio_zipupload2.png)
    
![...Select the zip file and click OK...](/images/RStudio_zipupload3.png)
    
![...The zip file automatically is unzipped.](/images/RStudio_zipupload4.png)

Alternatively, in RStudio, click File > New Project... > Version Control > Git (if a popup asks if you want to save your .RData file, say No). 
Enter the repository URL: 
```https://github.com/ESodja/AOU_R.git```
and name the project directory, e.g. `AOU_R`. Click 'Create Project'. This will copy all the pages from the github site where this website lives into your directory. The .R files you will be working with are in the R_Files folder.

![File > New Project](/images/RStudio_project1.png)

![Version control](/images/RStudio_project2.png)

![Git](/images/RStudio_project3.png)

![Repository URL and folder name](/images/RStudio_project4.png)

![Imported folder](/images/RStudio_project5.png)


### 4. **Copy and paste the SQL code generated by the dataset builder to an R document named “Data_import.R”**

Once your dataset is selected in the dataset builder, click on 'Analyze', select the 'R' button, click 'Copy Code' and wait until a message tells you it has been copied to the clipboard (this may take several seconds). Click 'Cancel' in the popup window, click on the RStudio icon in the purple bar on the right side of the window, and click 'Open RStudio'. 

Your Files tab should already have the R scripts from the zip file. Click on Data_import.R to open it in the script editor pane, then below the comments at the top of the file paste the SQL code copied from the dataset builder. Save this file and close it.

> Tip: If you change *anything* about the dataset definition in the dataset builder on the workbench, you will have to re-do this step!

![After dataset is built, click 'Analyze'](/images/SQL_analyze.png)

![Click the button next to R and then Copy Code](/images/SQL_analyze2.png)

![Wait for confirmation of the copy and click Cancel](/images/SQL_analyze3.png)

![Click on the RStudio icon](/images/SQL_analyze4.png)

![Click Open RStudio](/images/SQL_analyze5.png)

![Click Data_import.R](/images/SQL_analyze6.png)

![Paste the copied code into the script](/images/SQL_analyze7.png)

![Save and close the script](/images/SQL_analyze8.png)

[screenshots need arrows and pointers]

### 5. **Determine what analyses need to be run for your specific research interests (i.e. identify endpoints on the table above for the kinds of plots and statistical analyses that would be useful)**
    
[example]

### 6. **Work backwards on the flowchart to see which files need to be run to perform those analyses**

`Data_import.R' is essential and should be run first to pull the data from the database.
`dataprep_[something].R` files are helpful to clean and structure data for analysis.
If you are joining two types of data, e.g. condition and survey data, you should run `join_surv_cond.R' to connect them together based on the id of the individuals in your data.
Generating plots of a given relationship is achieved by using the `plot_[something].R` files.
Analyses are done in files with the name of the analysis in the file name, e.g. an ANOVA analysis between condition and measurement data is performed by `cond_meas_anova.R`. 

### 7. **Run the file from the console by entering `source(‘filename.R’)` for each necessary file, starting from the top (the first one should be Data_import.R)**

You can also open each file and run each line individually by placing the cursor on the first line and pressing ctrl+enter (or cmd+return) repeatedly, once for each line of the file. 
This is especially helpful if you've modified the code somewhere and need to track down an error.

### 8. **After all the files have run, view the generated outputs under the “files” tab in RStudio**

If the output plots need modification, you can open the plotting files (`plot_[something].R`; bottom row of the flowchart) and follow commented instructions and alternative code to modify the output. 
These changes only require re-running the ploting file and not the entire analysis. 
    
## Notes:

If data joins need to be modified, the R files used in the next row up on the flowchart (named like `dataprep_[something].R`) should also be modified so that the join includes the right data in the correct format. Instructions will be included in the join files for common ways to do this. 

After modifying the files (except plotting files, though it wouldn't hurt for these as well), you will probably want to restart R (click on session > Restart R) and run each file individually from the beginning to make sure the results are correct.

Here is an [example of a coding workflow](/examples/bmi_coding).
